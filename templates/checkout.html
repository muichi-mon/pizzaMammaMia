{% extends "home_base.html" %}

{% block title %}Pizza Mamma Mia â€” Checkout{% endblock %}

{% block hero %}{% endblock %}

{% block content %}
<section class="checkout">
    <h2>Order Summary</h2>

    {% if cart_items %}
        <table class="checkout-table">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart_items %}
                <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>â‚¬{{ "%.2f"|format(item.price) }}</td>
                    <td>â‚¬{{ "%.2f"|format(item.quantity * item.price) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Discount Code Section -->
        <div class="discount-section">
            {% if not is_birthday %}
                <form action="{{ url_for('apply_discount') }}" method="POST" class="discount-form">
                    <input type="text" name="discount_code" placeholder="Enter discount code" 
                           value="{{ discount_code if discount_code else '' }}" 
                           {% if discount_code %}disabled{% endif %}>
                    {% if discount_code %}
                        <button type="button" onclick="document.getElementById('remove-discount-form').submit();" class="btn-remove">Remove</button>
                    {% else %}
                        <button type="submit" class="btn-apply">Apply</button>
                    {% endif %}
                </form>
                <form id="remove-discount-form" action="{{ url_for('remove_discount') }}" method="POST" style="display:none;"></form>
            {% endif %}
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
            <p>Subtotal: â‚¬{{ subtotal }}</p>
            
            {% if discounts %}
                {% for discount in discounts %}
                    <p class="discount-line">{{ discount.description }}: -â‚¬{{ "%.2f"|format(discount.amount) }}</p>
                {% endfor %}
                <p class="total-discount">Total Discounts: -â‚¬{{ total_discount }}</p>
            {% endif %}
            
            <p class="checkout-total">Total: <strong>â‚¬{{ total_price }}</strong></p>
        </div>

        <!-- Estimated Delivery Time -->
        <div class="delivery-info">
            <p class="delivery-estimate">
                <strong>ðŸšš Estimated Delivery:</strong> {{ estimated_delivery_minutes }} minutes 
                (by {{ estimated_delivery_time }})
            </p>
        </div>

        <!-- Place Order -->
        <form action="{{ url_for('place_order_route') }}" method="POST">
            <button type="submit" class="btn">Place Order</button>
        </form>
    {% else %}
        <p>Your cart is empty.</p>
        <a href="{{ url_for('index') }}" class="btn">Browse Products</a>
    {% endif %}
</section>
{% endblock %}
